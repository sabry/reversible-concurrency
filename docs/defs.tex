% Some general macros

\newcommand{\pr}[1]{#1^{\prime}}
\newcommand{\fresh}[1]{\textit{fresh}~#1}
\newcommand{\defeq}{\stackrel{\mathrm{def}}{=}}
\newcommand{\bnfalt}{{\bf \,\,\mid\,\,}}
\newcommand{\bnfdef}{{\bf ::=}}
\newenvironment{nop}{}{}
\newenvironment{smathpar}
  {\begin{nop}\small\begin{mathpar}}
  {\end{mathpar}\end{nop}\ignorespacesafterend}

\newenvironment{sdisplaymath}
  {\begin{nop}\small\begin{displaymath}}
  {\end{displaymath}\end{nop}\ignorespacesafterend}

\newcommand{\elseextend}[2]{
  \ifthenelse{\isempty{#2}}
    {#1}
    {#1,#2}
}
% The basic language macros

%   Time macros
\newcommand{\maxtime}{\mathbb{M}}
\newcommand{\zerotime}{\mathbb{Z}}

%   Channel Macros
\newcommand{\tchctxt}[2]{
  \elseextend{#2}{#1}
}
\newcommand{\chctxt}[1][]{\tchctxt{#1}{\Updelta}}
\newcommand{\chctxtpr}[1][]{\tchctxt{#1}{\Updelta^{\prime}}}
\newcommand{\chx}[1][x]{#1}
\newcommand{\ch}[1][ch]{#1}
\newcommand{\chpr}{\ch[\ch^{\prime}]}

\newcommand{\stime}[1]{stime(#1)}
\newcommand{\rtime}[1]{rtime(#1)}
\newcommand{\ctime}[1]{ctime(#1)}

%   The language form macros
\newcommand{\unit}{\langle\rangle}
\newcommand{\e}{e}
\renewcommand{\v}{v}
\newcommand{\send}[2]{send~#1~#2}
\newcommand{\recv}[1][\chx]{recv~#1}
\newcommand{\yield}{yield}
\newcommand{\newchan}{newChan}
\renewcommand{\choose}[2]{choose~#1~#2}
\newcommand{\backtrack}{backtrack}
\newcommand{\return}[1][\v]{return~#1}

%   Evaluation context macros
\newcommand{\tectxt}[2]{
  \ifthenelse{\isempty{#1}}
    {#2}
    {#2(#1)}
}
\newcommand{\ectxt}[1][]{\tectxt{#1}{E}}
\newcommand{\ectxtpr}[1][]{\tectxt{#1}{\pr{E}}}
\newcommand{\ectxtone}[1][]{\tectxt{#1}{E_1}}
\newcommand{\ectxttwo}[1][]{\tectxt{#1}{E_2}}
\newcommand{\ectxtonepr}[1][]{\tectxt{#1}{\pr{E}_1}}
\newcommand{\ectxttwopr}[1][]{\tectxt{#1}{\pr{E}_2}}
\newcommand{\sync}[1]{sync~#1}

%   Process macros
\renewcommand{\P}{\mathcal{P}}
\newcommand{\Ppr}{\P^{\prime}}
\newcommand{\Pjudg}[2]{
  #1\|#2  
}
\newcommand{\thread}{\mathcal{D}}

%     Thread State macros
\newcommand{\pid}{\mathcal{I}}
\newcommand{\pidpr}{\pr{\pid}}
\renewcommand{\time}{\mathcal{T}}
\newcommand{\timepr}{\pr{\time}}
\newcommand{\ks}[1][]{
  \elseextend{\mathcal{K}}{#1}
}
\newcommand{\kspr}[1][]{
  \elseextend{\pr{\mathcal{K}}}{#1}
}
\newcommand{\ls}[1][]{
  \elseextend{\mathcal{L}_s}{#1}
}
\newcommand{\lr}[1][]{
  \elseextend{\mathcal{L}_r}{#1}
}
\newcommand{\choice}{\mathcal{S}}
\newcommand{\lspr}[1][]{
  \elseextend{\pr{\mathcal{L}}_s}{#1}
}
\newcommand{\lrpr}[1][]{
  \elseextend{\pr{\mathcal{L}}_r}{#1}
}
\newcommand{\choicepr}{\pr{\mathcal{S}}}
\newcommand{\lsone}[1][]{
  \elseextend{\mathcal{L}_{s1}}{#1}
}
\newcommand{\lrone}[1][]{
  \elseextend{\mathcal{L}_{r1}}{#1}
}
\newcommand{\lstwo}[1][]{
  \elseextend{\mathcal{L}_{s2}}{#1}
}
\newcommand{\lrtwo}[1][]{
  \elseextend{\mathcal{L}_{r2}}{#1}
}
\newcommand{\lsonepr}{\pr{\lsone}}
\newcommand{\lronepr}{\pr{\lrone}}
\newcommandx{\tctxt}[6][1=\pid,2=\time,3=\ks,4=\ls,5=\lr,6=\choice]{
  \left[#1;#2;#3;#4;#5;#6\right]  
}
\newcommand{\tctxtpr}{
  \tctxt[\pidpr][\timepr][\kspr][\lspr][\lrpr][\choicepr]
}
\newcommand{\tctxtone}{
  \tctxt[\pid_1][\time_1][\ks_1][\lsone][\lrone][\choice_1]  
}
\newcommand{\tctxttwo}{
  \tctxt[\pid_2][\time_2][\ks_2][\lstwo][\lrtwo][\choice_2]  
}
\newcommand{\tctxtonepr}{
  \tctxt[\pidpr_1][\timepr_1][\kspr_1][\lsonepr][\lronepr][\choicepr_1]  
}

%     Thread state shortcuts
\renewcommand{\gamma}{\Upgamma}
\newcommand{\gammapr}{\pr{\Upgamma}}

%   Thread macros
\newcommand{\threadjudg}[2]{
  #1#2  
}

%   Judgment macros
\newcommand{\judg}[5][]{
  #2:#3\Rightarrow_{#1}#4:#5
}
