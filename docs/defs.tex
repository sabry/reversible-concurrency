% Some general macros

\newcommand{\pr}[1]{#1^{\prime}}
\newcommand{\fresh}[1]{\textit{fresh}~#1}
\newcommand{\defeq}{\stackrel{\mathrm{def}}{=}}
\newcommand{\bnfalt}{{\bf \,\,\mid\,\,}}
\newcommand{\bnfdef}{{\bf ::=}}
\newenvironment{nop}{}{}
\newenvironment{smathpar}
  {\begin{nop}\small\begin{mathpar}}
  {\end{mathpar}\end{nop}\ignorespacesafterend}

\newenvironment{sdisplaymath}
  {\begin{nop}\small\begin{displaymath}}
  {\end{displaymath}\end{nop}\ignorespacesafterend}

\newcommand{\elseextend}[2]{
  \ifthenelse{\isempty{#2}}
    {#1}
    {#1,#2}
}
% The basic language macros

%   Time macros
\newcommand{\maxtime}{\mathbb{M}}
\newcommand{\zerotime}{\mathbb{Z}}

%   Channel Macros
\newcommand{\tchctxt}[2]{
  \elseextend{#2}{#1}
}
\newcommand{\CH}[1][]{\tchctxt{#1}{\Updelta}}
\newcommand{\CHpr}[1][]{\tchctxt{#1}{\Updelta^{\prime}}}
\newcommand{\chx}[1][x]{#1}
\newcommand{\ch}[1][ch]{#1}
\newcommand{\chpr}{\ch[\ch^{\prime}]}

\newcommand{\stime}[1]{stime(#1)}
\newcommand{\rtime}[1]{rtime(#1)}
\newcommand{\ctime}[1]{ctime(#1)}
\newcommand{\spr}{\pr{s}}
\newcommand{\rpr}{\pr{r}}
\newcommand{\cpr}{\pr{c}}

%   The language form macros
\newcommand{\unit}{\langle\rangle}
\newcommand{\e}{e}
\renewcommand{\v}{v}
\newcommand{\send}[2]{send~#1~#2}
\newcommand{\recv}[1][\chx]{recv~#1}
\newcommand{\yield}{yield}
\newcommand{\newchan}{newChan}
\renewcommand{\choose}[2]{choose~#1~#2}
\newcommand{\backtrack}{backtrack}
\newcommand{\return}[1][\v]{return~#1}

%   Evaluation context macros
\newcommand{\tectxt}[2]{
  \ifthenelse{\isempty{#1}}
    {#2}
    {#2(#1)}
}
\newcommand{\E}[1][]{\tectxt{#1}{E}}
\newcommand{\Epr}[1][]{\tectxt{#1}{\pr{E}}}
\newcommand{\Eone}[1][]{\tectxt{#1}{E_1}}
\newcommand{\Etwo}[1][]{\tectxt{#1}{E_2}}
\newcommand{\Eonepr}[1][]{\tectxt{#1}{\pr{E}_1}}
\newcommand{\Etwopr}[1][]{\tectxt{#1}{\pr{E}_2}}
\newcommand{\sync}[1]{sync~#1}

%   Process macros
\renewcommand{\P}{\mathcal{P}}
\newcommand{\Ppr}{\P^{\prime}}
\newcommand{\Pjudg}[2]{
  #1\|#2  
}
\newcommand{\K}{\mathcal{K}}
\renewcommand{\S}{\mathcal{S}}

%     Thread State macros
\newcommand{\pid}{\mathcal{I}}
\newcommand{\pidpr}{\pr{\pid}}
\newcommand{\T}{\mathcal{T}}
\newcommand{\Tpr}{\pr{\time}}
\newcommand{\Ks}[1][]{
  \elseextend{\mathcal{K}_s}{#1}
}
\newcommand{\Kspr}[1][]{
  \elseextend{\pr{\mathcal{K}_s}}{#1}
}
\newcommand{\Cs}[1][]{
  \elseextend{\mathcal{C}_s}{#1}
}
\newcommand{\Cr}[1][]{
  \elseextend{\mathcal{C}_r}{#1}
}

\newcommand{\Cspr}[1][]{
  \elseextend{\pr{\mathcal{C}}_s}{#1}
}
\newcommand{\Crpr}[1][]{
  \elseextend{\pr{\mathcal{C}}_r}{#1}
}

\newcommand{\Csone}[1][]{
  \elseextend{\mathcal{C}_{s1}}{#1}
}
\newcommand{\Crone}[1][]{
  \elseextend{\mathcal{C}_{r1}}{#1}
}
\newcommand{\Cstwo}[1][]{
  \elseextend{\mathcal{C}_{s2}}{#1}
}
\newcommand{\Crtwo}[1][]{
  \elseextend{\mathcal{C}_{r2}}{#1}
}
\newcommand{\Csonepr}{\pr{\lsone}}
\newcommand{\Cronepr}{\pr{\lrone}}
\newcommandx{\tctxt}[6][1=\pid,2=\time,3=\ks,4=\ls,5=\lr,6=\choice]{
  \left[#1;#2;#3;#4;#5;#6\right]  
}
\newcommand{\tctxtpr}{
  \tctxt[\pidpr][\timepr][\kspr][\lspr][\lrpr][\choicepr]
}
\newcommand{\tctxtone}{
  \tctxt[\pid_1][\time_1][\ks_1][\lsone][\lrone][\choice_1]  
}
\newcommand{\tctxttwo}{
  \tctxt[\pid_2][\time_2][\ks_2][\lstwo][\lrtwo][\choice_2]  
}
\newcommand{\tctxtonepr}{
  \tctxt[\pidpr_1][\timepr_1][\kspr_1][\lsonepr][\lronepr][\choicepr_1]  
}

%     Thread state shortcuts
\renewcommand{\gamma}{\Upgamma}
\newcommand{\gammapr}{\pr{\Upgamma}}

%   Thread macros
\newcommand{\Kjudg}[2]{
  #1:#2  
}

%   Judgment macros
\newcommand{\judg}[5][]{
  #2:#3\Rightarrow_{#1}#4:#5
}
